<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Mikis Stasinopoulos, Bob Rigby, Fernanda de Bastiani, Gillian Heller, Thomas Kneib, Andreas Mayr, Robert Rigby, Reto Stauffer, Nikolaus Umlauf, Achim Zeileis.">

<title>The Functions in the package gamlss.prepdata</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="gamlss_prepdata_functions_files/libs/clipboard/clipboard.min.js"></script>
<script src="gamlss_prepdata_functions_files/libs/quarto-html/quarto.js"></script>
<script src="gamlss_prepdata_functions_files/libs/quarto-html/popper.min.js"></script>
<script src="gamlss_prepdata_functions_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="gamlss_prepdata_functions_files/libs/quarto-html/anchor.min.js"></script>
<link href="gamlss_prepdata_functions_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="gamlss_prepdata_functions_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="gamlss_prepdata_functions_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="gamlss_prepdata_functions_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="gamlss_prepdata_functions_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="gamlss_prepdata_functions_files/libs/quarto-diagram/mermaid.min.js"></script>
<script src="gamlss_prepdata_functions_files/libs/quarto-diagram/mermaid-init.js"></script>
<link href="gamlss_prepdata_functions_files/libs/quarto-diagram/mermaid.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="gamlss_prepdata_functions.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">The Functions in the package <code>gamlss.prepdata</code></h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Mikis Stasinopoulos, Bob Rigby, Fernanda de Bastiani, Gillian Heller, Thomas Kneib, Andreas Mayr, Robert Rigby, Reto Stauffer, Nikolaus Umlauf, Achim Zeileis. </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="sec-introduction" class="level1">
<h1>Introduction</h1>
<p>This is a booklet for the packages <strong>gamlss.prepdata</strong> and its functionality. It tries to describe the available functions and their output.</p>
<!--  At a later stage, we will try to describe their rational. -->
<p>The latest versions of the packages <strong>gamlss</strong>, <strong>gamlss2</strong> and <strong>gamlss.prepdata</strong> are shown below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>())</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">#getRversion()</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gamlss)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gamlss2)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gamlss.ggplots)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gamlss.prepdata)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"dplyr"</span>) </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">packageVersion</span>(<span class="st">"gamlss"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] '5.4.23'</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">packageVersion</span>(<span class="st">"gamlss2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] '0.1.0'</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">packageVersion</span>(<span class="st">"gamlss.prepdata"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] '0.1.4'</code></pre>
</div>
</div>
<p>Note that the <strong>gamlss.prepdata</strong> came originally from the package <strong>gamlss.ggplots</strong>. The problem was that the package <strong>gamlss.ggplots</strong> become too large for maintenance so we split it in two.</p>
<p>Because the package is at an experimental stage, some of the functions are hidden to allow time for checking. The hidden functions can be accessed using <code>gamlss.prepdata:::</code>.</p>
<p>The functions available in <strong>gamlss.prepdata</strong> are function to be used <em>before-fitting</em>, that is, before the use of the functions <code>gamlss()</code> or <code>gamlss2()</code>. The functions in <strong>gamlss.prepdata</strong> can be divided into the following categories;</p>
<ol type="i">
<li><p><code>information</code> about the data functions</p></li>
<li><p><code>manipulation</code> of variables or observations functions</p></li>
<li><p><code>plotting</code> functions;</p></li>
<li><p><code>partition</code> functions</p></li>
</ol>
<p>The information within the data and the plotting functions can help the modelling by providing information about the;</p>
<ul>
<li>the <code>response</code> variable and its distribution</li>
<li>about the <code>explanatory</code> variables and in particular
<ul>
<li>their <code>spead</code> of values;</li>
<li><code>missing</code> values;</li>
<li><code>outliers</code>;</li>
<li><code>correlation</code> between explanatory variables</li>
<li><code>interactions</code> between explanatory variables</li>
</ul></li>
<li>the <code>type</code> of relationships between the response and explanatory variables, i.e.&nbsp;<code>linear</code> or <code>not-linear</code>.</li>
</ul>
<p>The manipulation of variables functions had to do with;</p>
<ul>
<li><code>transformation</code> of variables to be more suitable for modelling and</li>
<li><code>feature</code> extraction.</li>
</ul>
<p>Note that by feature we mean a function of the more that one explanatory variables while by transformation we use only one <span class="math inline">\(x\)</span>.</p>
<p>The data partitions has to do with ensuring better model selection. Note that data partition is part of what we could call data manipulations which includes merging and transforming data sets but also data partition. We only deal with the latest.</p>
<p>All the <em>pre-fitting</em> functions have to do with data and distribution families. Their names start with <strong>data</strong> and <strong>family</strong> respectively; For example</p>
<ul>
<li><p><strong>data_NAME</strong> prints information, plots or manipulate data frames;</p></li>
<li><p><strong>family_NAME</strong> plots or dislay properies of different theoretical GAMLSS distributions.</p></li>
</ul>
<section id="the-basic-model" class="level2">
<h2 class="anchored" data-anchor-id="the-basic-model">The basic model</h2>
<p>The aim of this vignette is to manipilate data before a distributional regression analysis is applied to the data. The general distributional regression model is; <span id="eq-GAMLSS_ML"><span class="math display">\[
\begin{split}
\textbf{y}     &amp;  \stackrel{\small{ind}}{\sim }  \mathcal{D}( \boldsymbol{\theta}_1, \ldots, \boldsymbol{\theta}_k) \nonumber \\
g_1(\boldsymbol{\theta}_1) &amp;= \mathcal{ML}_1(\textbf{x}_{11},\textbf{x}_{21}, \ldots,  \textbf{x}_{p1}) \nonumber \\
\ldots &amp;= \ldots \nonumber\\
g_k(\boldsymbol{\theta}_k) &amp;= \mathcal{ML}_k(\textbf{x}_{1k},\textbf{x}_{2k}, \ldots,  \textbf{x}_{pk}).
\end{split}
  \tag{1}\]</span></span> where we assume that the response variable <span class="math inline">\(y_i\)</span> for <span class="math inline">\(i=1,\ldots, n\)</span>, is independently distributed having a distribution <span class="math inline">\(\mathcal{D}( \theta_1, \ldots, \theta_k)\)</span> with <span class="math inline">\(k\)</span> parameters and where all parameters could be effected by the explanatory variables <span class="math inline">\(\textbf{x}_{1},\textbf{x}_{2}, \ldots,  \textbf{x}_{p}\)</span>. The <span class="math inline">\(\mathcal{ML}\)</span> represents any regression type machine learning algorithm i.e.&nbsp;LASSO, Neural networks etc.</p>
<p>When only <strong>additive smoothing</strong> terms are used in the fitting the model can be written as; <span id="eq-GAMLSS"><span class="math display">\[\begin{split}
\textbf{y}     &amp;  \stackrel{\small{ind}}{\sim }  \mathcal{D}(  \boldsymbol{\theta}_1, \ldots,  \boldsymbol{\theta}_k) \nonumber \\
g_1( \boldsymbol{\theta}_1)  &amp;= b_{01} + s_1(\textbf{x}_{11})  +  \cdots,  +s_p(\textbf{x}_{p1}) \nonumber\\
\ldots &amp;= \ldots \nonumber\\
g_k( \boldsymbol{\theta}_k)  &amp;= b_{0k} + s_1(\textbf{x}_{1k})  +   \cdots,  +s_p(\textbf{x}_{pk}).
\end{split}
\tag{2}\]</span></span> which is the GAMLSS model introduced by <span class="citation" data-cites="RigbyStasinopoulos05">Rigby and Stasinopoulos (<a href="#ref-RigbyStasinopoulos05" role="doc-biblioref">2005</a>)</span>.</p>
<p>The problem with trying to fitting any model is that the data should be prepared for the analysis. This is the aim of this package. To prepare data and get out useful information which could be used for the modelling stage.</p>
</section>
</section>
<section id="sec-Information" class="level1">
<h1>Information</h1>
<p>There are several function for obtaining information from data. Those function could get;</p>
<ul>
<li><p>general information about the data;</p></li>
<li><p>information about the variables in the data;</p></li>
<li><p>information about observations in the data;</p></li>
</ul>
<p>All function have as a first argument a <code>data.frame</code>.</p>
<p>Here are the functions of the package.</p>
<section id="sec-data_dim" class="level2">
<h2 class="anchored" data-anchor-id="sec-data_dim"><code>data_dim()</code></h2>
<p>This function gives information about the dimensions of the <code>data.frame</code>; The function is similar to the <strong>R</strong> function <code>dim()</code>, but gives a bit more information. Its output is the original data frame which means it can be use in a series of piping commands.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>rent99 <span class="sc">|&gt;</span> <span class="fu">data_dim</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>************************************************************** 
************************************************************** 
the R class of the data is: data.frame 
the dimensions of the data are: 3082 by 9 
number of observations with missing values: 0 
% of NA's in the data: 0 % 
************************************************************** 
************************************************************** </code></pre>
</div>
</div>
</section>
<section id="sec-data_which_na" class="level2">
<h2 class="anchored" data-anchor-id="sec-data_which_na"><code>data_which_na()</code></h2>
<p>This function gives information about which variables have missing observations and how many;</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>rent99 <span class="sc">|&gt;</span> <span class="fu">data_which_na</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    rent  rentsqm     area    yearc location     bath  kitchen cheating 
       0        0        0        0        0        0        0        0 
district 
       0 </code></pre>
</div>
</div>
<p>The output of the function is the original data frame nothing is changing.</p>
</section>
<section id="sec-data_names" class="level2">
<h2 class="anchored" data-anchor-id="sec-data_names"><code>data_omit</code></h2>
<p>This function uses the <strong>R</strong> function <code>na.omit()</code> to. omit lines with NA’s in the data;</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>rent99 <span class="sc">|&gt;</span> <span class="fu">data_omit</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>************************************************************** 
************************************************************** 
the R class of the data is: data.frame 
the dimensions of the data before omition are: 3082 x 9 
the dimensions of the data saved after omition are: 3082 x 9 
the number of observations omited: 0 
************************************************************** 
************************************************************** </code></pre>
</div>
</div>
<p>The output of the function is a new data frame with all NA’s omitted.</p>
</section>
<section id="data_names" class="level2">
<h2 class="anchored" data-anchor-id="data_names"><code>data_names()</code></h2>
<p>This function provides the names of the variables (same as <strong>R</strong> <code>names()</code> function);</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>rent99 <span class="sc">|&gt;</span> <span class="fu">data_names</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>************************************************************** 
************************************************************** 
the names of variables 
[1] "rent"     "rentsqm"  "area"     "yearc"    "location" "bath"     "kitchen" 
[8] "cheating" "district"
************************************************************** 
************************************************************** </code></pre>
</div>
</div>
<p>The output of the function is the original data frame.</p>
</section>
<section id="sec-data_distinct" class="level2">
<h2 class="anchored" data-anchor-id="sec-data_distinct"><code>data_distinct()</code></h2>
<p>The district values for each variable are shown here.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>rent99 <span class="sc">|&gt;</span> <span class="fu">data_distinct</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    rent  rentsqm     area    yearc location     bath  kitchen cheating 
    2723     3053      132       68        3        2        2        2 
district 
     336 </code></pre>
</div>
</div>
<p>The output of the function is the original data frame.</p>
</section>
<section id="sec-data_str" class="level2">
<h2 class="anchored" data-anchor-id="sec-data_str"><code>data_str()</code></h2>
<p>The function <code>data_str()</code> (similar to the <strong>R</strong> function <code>str()</code>) provides information about the types of variable exist in the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>rent99 <span class="sc">|&gt;</span> <span class="fu">data_str</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>************************************************************** 
************************************************************** 
the structure of the data 
'data.frame':   3082 obs. of  9 variables:
 $ rent    : num  110 243 262 106 133 ...
 $ rentsqm : num  4.23 8.69 8.72 3.55 4.45 ...
 $ area    : int  26 28 30 30 30 30 31 31 32 33 ...
 $ yearc   : num  1918 1918 1918 1918 1918 ...
 $ location: Factor w/ 3 levels "1","2","3": 2 2 1 2 2 2 1 1 1 2 ...
 $ bath    : Factor w/ 2 levels "0","1": 1 1 1 1 1 1 1 1 1 1 ...
 $ kitchen : Factor w/ 2 levels "0","1": 1 1 1 1 1 1 1 2 1 1 ...
 $ cheating: Factor w/ 2 levels "0","1": 1 2 2 1 2 2 1 2 1 1 ...
 $ district: int  916 813 611 2025 561 541 822 1713 1812 152 ...
************************************************************** 
************************************************************** 
table of the class of variabes 

 factor integer numeric 
      4       2       3 
************************************************************** 
************************************************************** 
distinct values in variables 
    rent  rentsqm     area    yearc location     bath  kitchen cheating 
    2723     3053      132       68        3        2        2        2 
district 
     336 
consider to make those characters vectors into factors: 
location bath kitchen cheating 
************************************************************** 
************************************************************** </code></pre>
</div>
</div>
<p>The output of the function is the original data frame.</p>
</section>
<section id="sec-data_shorter_names" class="level2">
<h2 class="anchored" data-anchor-id="sec-data_shorter_names"><code>data_shorter_names()</code></h2>
<p>If variables in the data have very long names are difficult to handle in formulae when modelling. The function <code>data_shorter_names()</code> abbreviate the names of the explanatory variables so they can easily introduced in a formulae;</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>rent99 <span class="sc">|&gt;</span> <span class="fu">data_shorter_names</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>************************************************************** 
************************************************************** 
the names of variables 
[1] "rent"  "rents" "area"  "yearc" "locat" "bath"  "kitch" "cheat" "distr"
************************************************************** 
************************************************************** </code></pre>
</div>
</div>
<p>No long names exist in this specific data set so there is no action. The output of the function is the original data frame with new names.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that there is a danger here to to use a small <code>max</code> option and you can end up with identical names for variables.</p>
</div>
</div>
</section>
<section id="sec-data_rename" class="level2">
<h2 class="anchored" data-anchor-id="sec-data_rename"><code>data_rename()</code></h2>
<p>If you wish to rename variable use the function <code>data_rename()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>da<span class="ot">&lt;-</span> rent99 <span class="sc">|&gt;</span> <span class="fu">data_rename</span>(<span class="at">oldname=</span><span class="st">"rent"</span>, <span class="at">newname=</span><span class="st">"R"</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(da)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         R   rentsqm area yearc location bath kitchen cheating district
1 109.9487  4.228797   26  1918        2    0       0        0      916
2 243.2820  8.688646   28  1918        2    0       0        1      813
3 261.6410  8.721369   30  1918        1    0       0        1      611
4 106.4103  3.547009   30  1918        2    0       0        0     2025
5 133.3846  4.446154   30  1918        2    0       0        1      561
6 339.0256 11.300851   30  1918        2    0       0        1      541</code></pre>
</div>
</div>
<p>The output of the function is the original data frame with new names.</p>
</section>
</section>
<section id="sec-Manipulation" class="level1">
<h1>Manipulation of variables within data</h1>
<p>The next set of functions manipulate variables withing <code>data.frame</code>s.</p>
<section id="sec-data_cha2fac" class="level2">
<h2 class="anchored" data-anchor-id="sec-data_cha2fac"><code>data_cha2fac()</code></h2>
<p>Often variables in the data sets are read as character vectors while in the analysis we need them as <code>factors</code>. This function transforms any character vector (with relatively small number of distinct values) into a factor;</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>rent99 <span class="sc">|&gt;</span> <span class="fu">data_cha2fac</span>()  <span class="ot">-&gt;</span> da </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>************************************************************** 
not character vector was found </code></pre>
</div>
</div>
<p>Since no character were found nothing have changed. The output of the function is a new data frame.</p>
</section>
<section id="sec-data_few2fac" class="level2">
<h2 class="anchored" data-anchor-id="sec-data_few2fac"><code>data_few2fac()</code></h2>
<p>There are occasions in which some variables have very few distinct observations, and it will be better to treat them as factors. The function <code>data_few2fac()</code> transfer vectors with few distinct values to factors.</p>
<p>The output of the function is a new data frame. This can be seen by using the <strong>R</strong> function <code>str()</code>;</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>rent99 <span class="sc">|&gt;</span>  <span class="fu">data_few2fac</span>() <span class="ot">-&gt;</span> da </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>************************************************************** 
    rent  rentsqm     area    yearc location     bath  kitchen cheating 
    2723     3053      132       68        3        2        2        2 
district 
     336 
************************************************************** 
4 vectors with fewer number of values than 10 were transformed to factors 
************************************************************** 
************************************************************** </code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(da)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   3082 obs. of  9 variables:
 $ rent    : num  110 243 262 106 133 ...
 $ rentsqm : num  4.23 8.69 8.72 3.55 4.45 ...
 $ area    : int  26 28 30 30 30 30 31 31 32 33 ...
 $ yearc   : num  1918 1918 1918 1918 1918 ...
 $ location: Factor w/ 3 levels "1","2","3": 2 2 1 2 2 2 1 1 1 2 ...
 $ bath    : Factor w/ 2 levels "0","1": 1 1 1 1 1 1 1 1 1 1 ...
 $ kitchen : Factor w/ 2 levels "0","1": 1 1 1 1 1 1 1 2 1 1 ...
 $ cheating: Factor w/ 2 levels "0","1": 1 2 2 1 2 2 1 2 1 1 ...
 $ district: int  916 813 611 2025 561 541 822 1713 1812 152 ...</code></pre>
</div>
</div>
</section>
<section id="sec-data_int2num" class="level2">
<h2 class="anchored" data-anchor-id="sec-data_int2num"><code>data_int2num()</code></h2>
<p>Occasionally we want to transfer integer variables vectors with a very large range of value into numeric vectors, especially for graphics. The function <code>data_int2num()</code> is doing this;</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>rent99 <span class="sc">|&gt;</span> <span class="fu">data_int2num</span>() <span class="ot">-&gt;</span> da</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>************************************************************** 
    rent  rentsqm     area    yearc location     bath  kitchen cheating 
    2723     3053      132       68        3        2        2        2 
district 
     336 
2 integer vectors with more number of values than 50 were transformed to numeric 
************************************************************** </code></pre>
</div>
</div>
<p>The output of the function is a new data frame.</p>
</section>
<section id="sec-data_rm" class="level2">
<h2 class="anchored" data-anchor-id="sec-data_rm"><code>data_rm()</code></h2>
<p>For plotting data sets it is easier if we could keep only the relevant variables. The function <code>data_rm()</code> can do that;</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data_rm</span>(rent99, <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">9</span>)) <span class="ot">-&gt;</span> da</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(rent99)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3082    9</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(da)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3082    7</code></pre>
</div>
</div>
<p>The output of the function is a new data frame. Note that this could be also done using the function <code>select()</code> of the package <strong>dplyr</strong>, or our own <code>data_select()</code> function.</p>
</section>
<section id="data_select" class="level2">
<h2 class="anchored" data-anchor-id="data_select"><code>data_select()</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>da1<span class="ot">&lt;-</span>rent <span class="sc">|&gt;</span> <span class="fu">data_select</span>( <span class="at">vars=</span><span class="fu">c</span>(<span class="st">"R"</span>, <span class="st">"Fl"</span>, <span class="st">"A"</span>))</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(da1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       R Fl    A
1  693.3 50 1972
2  422.0 54 1972
3  736.6 70 1972
4  732.2 50 1972
5 1295.1 55 1893
6 1195.9 59 1893</code></pre>
</div>
</div>
<p>The output of the function is a new data frame.</p>
</section>
<section id="sec-data_rm1val" class="level2">
<h2 class="anchored" data-anchor-id="sec-data_rm1val"><code>data_rm1val()</code></h2>
<p>This function looks for variables with a unique distinct value (most likely factors left from a previous <code>subset()</code> operations) and removes them form the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>da <span class="sc">|&gt;</span> <span class="fu">data_rm1val</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The output of the function is a new data frame.</p>
</section>
<section id="sec-data_exclude_class" class="level2">
<h2 class="anchored" data-anchor-id="sec-data_exclude_class"><code>data_exclude_class()</code></h2>
<p>This function looks for variable (columns) of a specified <strong>R</strong> class and remove them from the data. The default class to remove is <code>factor</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>da <span class="sc">|&gt;</span> <span class="fu">data_exclude_class</span>()  <span class="ot">-&gt;</span> da1</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(da1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      rent area yearc
1 109.9487   26  1918
2 243.2820   28  1918
3 261.6410   30  1918
4 106.4103   30  1918
5 133.3846   30  1918
6 339.0256   30  1918</code></pre>
</div>
</div>
<p>The output of the function is a new data frame.</p>
</section>
<section id="sec-data_continuous" class="level2">
<h2 class="anchored" data-anchor-id="sec-data_continuous"><code>data_only_continuous()</code></h2>
<p>This function keeps only the continuous variables in the data set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>da <span class="sc">|&gt;</span> <span class="fu">data_only_continuous</span>()  <span class="ot">-&gt;</span> da1</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(da1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      rent area yearc
1 109.9487   26  1918
2 243.2820   28  1918
3 261.6410   30  1918
4 106.4103   30  1918
5 133.3846   30  1918
6 339.0256   30  1918</code></pre>
</div>
</div>
<p>The output of the function is a new data frame.</p>
</section>
</section>
<section id="sec-Graphical_procedures" class="level1">
<h1>Graphical procedures for data</h1>
<p>The reason why any graphical methods is used at a preliminary stage of a distribution regression analysis is to get a <em>taste</em> of the data in order to help to identify;</p>
<ul>
<li><p><code>outliers</code> in both the response and the explanatory variables.</p></li>
<li><p><code>transformatons</code> needed for explanatory variables</p></li>
<li><p><code>linear</code> or <code>non-linear</code> correlation between the explanatory variables</p></li>
<li><p>the existence of <code>pairwise interactions</code> between features.</p></li>
</ul>
<p>Outliers, in the continuous explanatory variables of the data, effect the curve fitting (linear or smooth non-linear) between the parameters of the distribution of the response and the features. Often, the removal of outliers could make the fit more robust. The function <code>data_zscores()</code> use simple a algorithm for identifying possible outliers in continuous explanatory variables.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>It is difficult, at the preliminary stage of the analysis, where no model has been fitted yet to identify outliers for factors. This is, because outliers in factors do not look strange when we look at the variables individually. Their outliers status is apparent only when we looked at them in combination with other variables but this is performed at the modelling stage.</p>
</div>
</div>
<section id="sec-data_plot" class="level2">
<h2 class="anchored" data-anchor-id="sec-data_plot"><code>data_plot()</code></h2>
<p>The function <code>data_plot</code> plots all the variable of the data individually; It plots the continuous variable as <em>histograms</em> with a density plots superimposed, see the plot for <code>rent</code> and <code>yearc</code>. As an alternative a <code>dot plots</code> can be requested see for an example in <a href="#sec-data_response" class="quarto-xref">Section&nbsp;4.8</a>. For integers the function plots <em>needle</em> plots, see <code>area</code> below and for categorical the function plots <em>bar</em> plots, see <code>location</code>, <code>bath</code> <code>kitchen</code> and <code>cheating</code> below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>da <span class="sc">|&gt;</span> <span class="fu">data_plot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 100 % of data are saved, 
that is, 3082 observations. </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 2 rows containing missing values or values outside the scale range
(`geom_bar()`).
Removed 2 rows containing missing values or values outside the scale range
(`geom_bar()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="gamlss_prepdata_functions_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The function could saves the <code>ggplot2</code> figures.</p>
</section>
<section id="sec-data_xyplot" class="level2">
<h2 class="anchored" data-anchor-id="sec-data_xyplot"><code>data_xyplot()</code></h2>
<p>The functions <code>data_xyplot()</code> plots the response variable against each of the independent explanatory variables. It plots the continuous against continuous as <em>scatter</em> plots and continuous variables against categorical as <em>box</em> plot.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>At the moment there is no provision for categorical response variables.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>da <span class="sc">|&gt;</span> <span class="fu">data_xyplot</span>(<span class="at">response=</span>rent )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 100 % of data are saved, 
that is, 3082 observations. </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using method = 'gam' and formula = 'y ~ s(x, bs = "cs")'
`geom_smooth()` using method = 'gam' and formula = 'y ~ s(x, bs = "cs")'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="gamlss_prepdata_functions_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The output of the function saves the <code>ggplot2</code> figures.</p>
</section>
<section id="sec-data_bucket" class="level2">
<h2 class="anchored" data-anchor-id="sec-data_bucket"><code>data_bucket()</code></h2>
<p>The function <code>data_bucket</code> can be used to identifies hight skewness and kurtosis on continuous variables in the data. Note that if the continuous variable is normaly distribueterd looking should be in the center of the figure.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data_bucket</span>(da, <span class="at">response=</span>rent )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 100 % of data are saved, 
that is, 3082 observations. 
    rent     area    yearc location     bath  kitchen cheating 
    2723      132       68        3        2        2        2 </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="gamlss_prepdata_functions_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="sec-data_cor" class="level2">
<h2 class="anchored" data-anchor-id="sec-data_cor"><code>data_cor()</code></h2>
<p>The function <code>data_corr()</code> is taking a <code>data.frame</code> object and plot the correlation coefficients of all its continuous variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data_cor</span>(da, <span class="at">lab=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 100 % of data are saved, 
that is, 3082 observations. 
4 factors have been omited from the data </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in data_cor(da, lab = TRUE):</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="gamlss_prepdata_functions_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>A different type of plot can be produce if we use;</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data_cor</span>(da, <span class="at">method=</span><span class="st">"circle"</span>, <span class="at">circle.size =</span> <span class="dv">40</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 100 % of data are saved, 
that is, 3082 observations. 
4 factors have been omited from the data </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in data_cor(da, method = "circle", circle.size = 40):</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="gamlss_prepdata_functions_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>To get the variables with higher, say, than $0.4 $ correlation values use;</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>Tabcor <span class="ot">&lt;-</span> <span class="fu">data_cor</span>(da, <span class="at">plot=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 100 % of data are saved, 
that is, 3082 observations. 
4 factors have been omited from the data </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in data_cor(da, plot = FALSE):</code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">high_val</span>(Tabcor, <span class="at">val=</span><span class="fl">0.4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     name1  name2  corrs  
[1,] "rent" "area" "0.585"</code></pre>
</div>
</div>
</section>
<section id="sec-data_void" class="level2">
<h2 class="anchored" data-anchor-id="sec-data_void"><code>data_void()</code></h2>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>This function is new. Its theoretical foundation are not proven yet. The function needs testing and therefore it should be used with causion.</p>
</div>
</div>
<p>The idea behind the function is to be able to identify whether the data in the direction of two continuous variables say <span class="math inline">\(x_i\)</span> and <span class="math inline">\(x_j\)</span> have a lot of empty spaces. The reason is that empty spaces effect prediction since interpolation at empty spaces is dengerous.<br>
The function <code>data_void()</code> is taking a <code>data.frame</code> object and plot the percentage of empty spaces for all pair-wise continuous variables. The function used the <code>foreach()</code> function of the package <strong>foreach</strong> to allow parallel processing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoParallel</span>(<span class="at">cores =</span> <span class="dv">9</span>)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data_void</span>(da)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 100 % of data are saved, 
that is, 3082 observations. 
4 factors have been omited from the data </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in data_void(da):</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="gamlss_prepdata_functions_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>A different type of plot can be produce if we use;</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data_void</span>(da, <span class="at">method=</span><span class="st">"circle"</span>, <span class="at">circle.size =</span> <span class="dv">40</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 100 % of data are saved, 
that is, 3082 observations. 
4 factors have been omited from the data </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in data_void(da, method = "circle", circle.size = 40):</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="gamlss_prepdata_functions_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stopImplicitCluster</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To get the variables with highter than $0.4 $ values use;</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>Tabvoid <span class="ot">&lt;-</span> <span class="fu">data_void</span>(da, <span class="at">plot=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 100 % of data are saved, 
that is, 3082 observations. 
4 factors have been omited from the data </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in data_void(da, plot = FALSE):</code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">high_val</span>(Tabvoid, <span class="at">val=</span><span class="fl">0.4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     name1  name2   corrs  
[1,] "rent" "area"  "0.661"
[2,] "rent" "yearc" "0.627"
[3,] "area" "yearc" "0.51" </code></pre>
</div>
</div>
</section>
<section id="sec-trans_pcor" class="level2">
<h2 class="anchored" data-anchor-id="sec-trans_pcor"><code>data_pcor()</code></h2>
<p>The function <code>data_copr()</code> is taking a <code>data.frame</code> object and plot the partial correlation coefficients of all its continuous variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data_pcor</span>(da, <span class="at">lab=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 100 % of data are saved, 
that is, 3082 observations. 
4 factors have been omited from the data </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in data_pcor(da, lab = TRUE):</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="gamlss_prepdata_functions_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>To get the variables with highter than $0.4 $ partial correlation values use;</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>Tabpcor <span class="ot">&lt;-</span> <span class="fu">data_pcor</span>(da, <span class="at">plot=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 100 % of data are saved, 
that is, 3082 observations. 
4 factors have been omited from the data </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in data_pcor(da, plot = FALSE):</code></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">high_val</span>(Tabpcor, <span class="at">val=</span><span class="fl">0.4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     name1  name2  corrs  
[1,] "rent" "area" "0.638"</code></pre>
</div>
</div>
</section>
<section id="sec-data_inter" class="level2">
<h2 class="anchored" data-anchor-id="sec-data_inter"><code>data_inter()</code></h2>
<p>The function <code>data_inter()</code> takes a <code>data.frame</code>, fits all pair-wise interactions of the explanatory variables against the response (using a normal model) and produce a graph displaying their significance levels. The idea behind this is to identify possible first order interactions at an early stage of the analysis. Note that at the moment it works with continuous variables as response.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>da <span class="sc">|&gt;</span> gamlss.prepdata<span class="sc">:::</span><span class="fu">data_inter</span>(<span class="at">response=</span> rent)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 100 % of data are saved, 
that is, 3082 observations. </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="gamlss_prepdata_functions_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>tinter <span class="ot">&lt;-</span>gamlss.prepdata<span class="sc">:::</span><span class="fu">data_inter</span>(da,  <span class="at">response=</span> rent, <span class="at">plot=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 100 % of data are saved, 
that is, 3082 observations. </code></pre>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>tinter</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         area yearc location  bath kitchen cheating
area       NA 0.014    0.001 0.119   0.000    0.000
yearc      NA    NA    0.000 0.027   0.154    0.226
location   NA    NA       NA 0.000   0.000    0.578
bath       NA    NA       NA    NA   0.868    0.989
kitchen    NA    NA       NA    NA      NA    0.719
cheating   NA    NA       NA    NA      NA       NA</code></pre>
</div>
</div>
<p>To get the variables with lower than $0.05 $ significant interactions use;</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>Tabinter <span class="ot">&lt;-</span> gamlss.prepdata<span class="sc">:::</span><span class="fu">data_inter</span>(da, <span class="at">response=</span> rent, <span class="at">plot=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 100 % of data are saved, 
that is, 3082 observations. </code></pre>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">low_val</span>(Tabinter)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     name1      name2      value  
[1,] "area"     "yearc"    "0.014"
[2,] "area"     "location" "0.001"
[3,] "yearc"    "location" "0"    
[4,] "yearc"    "bath"     "0.027"
[5,] "location" "bath"     "0"    
[6,] "area"     "kitchen"  "0"    
[7,] "location" "kitchen"  "0"    
[8,] "area"     "cheating" "0"    </code></pre>
</div>
</div>
<p>NOT DOCUMENTED IN HELP FOR THIS FUNCTION</p>
</section>
<section id="sec-data_response" class="level2">
<h2 class="anchored" data-anchor-id="sec-data_response"><code>data_response()</code></h2>
<p>The function <code>data_response()</code> plots four different plots related to a continuous response variable. It plots the histogram (and the density function), a <strong>dot plot</strong> of the response in the original scale and in the z-score scale. The z-score scale is defined by fitting a distribution to the variable (normal or SHASH) and then taking the residuals, see also next section. The dot plots are good in identify highly skew variables and unusual observations. They display the median and inter quantile range of the data. The y-axis of a dot plot is a randomised uniform variable (therefore the plot could look slightly different each time.)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>da <span class="sc">|&gt;</span> <span class="fu">data_response</span>(, <span class="at">response=</span>rent)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 100 % of data are saved, 
that is, 3082 observations. 
the class of the response is numeric is this correct? 
a continuous distribution on (0,inf) could be used </code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="gamlss_prepdata_functions_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="sec-Outliers" class="level1">
<h1>Outliers</h1>
<section id="sec-data_zscores" class="level2">
<h2 class="anchored" data-anchor-id="sec-data_zscores"><code>data_zscores()</code></h2>
<p>One could fit any four parameter (GAMLSS) distribution, defined on <span class="math inline">\(-\infty\)</span> to <span class="math inline">\(\infty\)</span>, to any continuous variable, where skewness and kurtosis is suspected and take the quantile residuals (or z-scores) as the transformed values x-values. The function <code>y_zscores()</code> performs just this. It takes a continuous variable and fits a continuous four parameter distribution and gives the z-scores. The fitting distribution can be specified by the user, but as default we have the SHASHo distribution. Below we demonstrate that the function y_zscores() is equivalent to fitting the SHASHo distribution to the continuous variable and then take the quqntile residuals from the fitted model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>da <span class="sc">|&gt;</span> <span class="fu">data_zscores</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="gamlss_prepdata_functions_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In order to see how the z-scores are calculated consider the function <code>y_zscores()</code> which is taking an individual variables z-scores;</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a> z <span class="ot">&lt;-</span> <span class="fu">y_zscores</span>(rent99<span class="sc">$</span>rent, <span class="at">plot=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The function is equivalent of fitting a constant model to all parameters of a distribution and taking the quantile residuals (or z=scores). The default distribution is the four parameter <code>SHASHo</code> distribution.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gamlss2)</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">gamlssML</span>(rent99<span class="sc">$</span>rent, <span class="at">family=</span>SHASHo) <span class="co"># fitting a 4 parameter distribution </span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(z,<span class="fu">resid</span>(m1))[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]<span class="co">#  and taking the residuals</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          z          
1 -2.496097 -2.496097
2 -1.340464 -1.340464
3 -1.182014 -1.182014
4 -2.526326 -2.526326
5 -2.295069 -2.295069</code></pre>
</div>
</div>
</section>
<section id="sec-data_outliers" class="level2">
<h2 class="anchored" data-anchor-id="sec-data_outliers"><code>data_outliers()</code></h2>
<p>The function <code>data_outliers()</code> uses the <em>z-scores</em> technique described above in order to detect outliers in the continuous data in the model. It fits a <code>SHASHo</code> distribution to the continuous variable in the data and uses the residual to identify outliers for those continuous variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data_outliers</span>(da)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    rent     area    yearc location     bath  kitchen cheating 
    2723      132       68        3        2        2        2 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>$rent
named numeric(0)

$area
named integer(0)

$yearc
named numeric(0)</code></pre>
</div>
</div>
<p>As it happend no individual variable outliers were highlighted in the <code>rent</code> data using the z-scores methodology.</p>
</section>
<section id="data_leverage" class="level2">
<h2 class="anchored" data-anchor-id="data_leverage"><code>data_leverage()</code></h2>
<p>The function <code>data_leverage()</code> uses the linear model methodology to identify unusual observations as a group within the explnatory variables. It fit a linear model to all explanatory variables in the data, calculate the leverge points and plots them.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>rent99[, <span class="sc">-</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">9</span>)] <span class="sc">|&gt;</span> <span class="fu">data_leverage</span>( <span class="at">response=</span>rent)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 100 % of data are saved, 
that is, 3082 observations. 
4 factors have been omited from the data </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in data_leverage(rent99[, -c(2, 9)], response = rent):</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="gamlss_prepdata_functions_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="sec-Feature_extraction" class="level1">
<h1>Feature extraction</h1>
<section id="sec-data_scale" class="level2">
<h2 class="anchored" data-anchor-id="sec-data_scale"><code>data_scale()</code></h2>
<p>Another form of transformation for continuous explanatory variables is <strong>standardization</strong>. Standardization means bringing all continuous explanatory variables to a similar range of values. For some machine learning techniques, i.e., principal component regression or neural networks standardization is mandatory in other like LASSO is recommended. There are two types of standardisation</p>
<ol type="i">
<li>scaling to normality and</li>
<li>scaling to a range from zero to one.</li>
</ol>
<p>First scalling to Normality that is, 0 mean, 1 standard deviation which is equivalent of fitting the narmal distrinition and taking the residuals.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">data_scale</span>(da, <span class="at">response=</span>rent))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    area    yearc location     bath  kitchen cheating 
     132       68        3        2        2        2 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>      rent       area      yearc location bath kitchen cheating
1 109.9487  0.7009962  0.7035881        2    0       0        0
2 243.2820 -0.4796117  0.7484206        2    0       0        1
3 261.6410 -0.2266243  0.6587556        1    0       0        1
4 106.4103 -0.3531180 -1.2242096        2    0       0        0
5 133.3846  0.1950214 -1.7173671        2    0       0        1
6 339.0256 -0.5639408  1.6450707        2    0       0        1</code></pre>
</div>
</div>
<p>Note hat he response is left unchanged.</p>
<p>Now standardised using the <code>SHASHo</code>;</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">data_scale</span>(da, <span class="at">response=</span>rent,  <span class="at">family=</span><span class="st">"SHASHo"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    area    yearc location     bath  kitchen cheating 
     132       68        3        2        2        2 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>      rent       area      yearc location bath kitchen cheating
1 109.9487  0.7390434  0.6323846        2    0       0        0
2 243.2820 -0.3940193  0.6795499        2    0       0        1
3 261.6410 -0.1175129  0.5864434        1    0       0        1
4 106.4103 -0.2526941 -1.0598183        2    0       0        0
5 133.3846  0.2949483 -1.6281459        2    0       0        1
6 339.0256 -0.4916986  2.0610405        2    0       0        1</code></pre>
</div>
</div>
<p>Standardised all continuous variable from o to zero (but not the response)</p>
<p>Now standardised using the <code>SHASHo</code>;</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">data_scale</span>(da, <span class="at">response=</span>rent,  <span class="at">scale.to=</span><span class="st">"0to1"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    area    yearc location     bath  kitchen cheating 
     132       68        3        2        2        2 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>      rent       area yearc location bath kitchen cheating
1 109.9487 0.04285714     0        2    0       0        0
2 243.2820 0.05714286     0        2    0       0        1
3 261.6410 0.07142857     0        1    0       0        1
4 106.4103 0.07142857     0        2    0       0        0
5 133.3846 0.07142857     0        2    0       0        1
6 339.0256 0.07142857     0        2    0       0        1</code></pre>
</div>
</div>
</section>
<section id="sec-trans_plot" class="level2">
<h2 class="anchored" data-anchor-id="sec-trans_plot"><code>data_trans_plot()</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>gamlss.prepdata<span class="sc">:::</span><span class="fu">data_trans_plot</span>(da, rent) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="gamlss_prepdata_functions_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>NOT DOCUMENTED IN HELP</p>
</section>
</section>
<section id="sec-Partition" class="level1">
<h1>Data Partition</h1>
<section id="sec-Intro_Partition" class="level3">
<h3 class="anchored" data-anchor-id="sec-Intro_Partition">Intodunction to data partition</h3>
<p>Partitioning the data is usefull to help modelling and check for overfitting. <a href="#fig-data_split" class="quarto-xref">Figure&nbsp;1</a> shows different ways the data can be split. A data set can be either reused or split. For big data sets it is sensible to split the sample data into <code>training</code>, and <code>test</code> data sets and if possible into an extra <code>validation</code> data set. The splitting of the data sets allows to check the performance, the suitability of the assumptions of the model but also for overfitting. If the fitted model, in the training, data perform reasonable in the <code>test</code> data then one could feel that <strong>overfitting</strong> is avoided. Overfitting occurs when the model is very close to the sample but the sample is far from the population so the model do not generalised well. By <strong>underfitting</strong>, we mean a bad model. That is, a model which is far from both the sample but also from the population. There are different ways for checking and comparing models like the generalised Akaike criterion, <strong>GAIC</strong>, cross validation, <strong>CV</strong>, predictive deviance, <strong>PD</strong>, and continuous rank probability scores, <strong>CRPS</strong>. Partitioning the data into training, test and validation (for estimation hyper-parameters) has to be done randomly. An inherent risk for slitting the data comes when the interest of the investigation lies on the tail of the distribution of the response. If the few extreme observations fall into only one of the partitions of the data this will create problems. Repetitively reusing (parts) of the data, i.e.&nbsp;bootstrapping, avoid the problem.</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div id="fig-data_split" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-data_split-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>
<pre class="mermaid mermaid-js" data-label="fig-data_split">flowchart TB
  A[Data] --&gt; B{Reuse} 
  A --&gt; C{Split}
  C --&gt; D[Training]
  D --&gt; E[Validate]
  E --&gt; O[Test]
  B --&gt; F(Rearranged)
  B --&gt; G(Reweighed)
  G--&gt; H(Bayesian \n Bootstrap)
  G--&gt; J(Boosting)
  F --&gt; K(Non-param. \n Bootstrap)
  F --&gt; L(Cross \n Validation)
  L --&gt; M(k-Fold) 
  L --&gt; N(LOO) 
</pre>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-data_split-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Different ways of splitting data to get in order to get more information”
</figcaption>
</figure>
</div>
</div>
</div>
<p>The “Reuse” part of <a href="#fig-data_split" class="quarto-xref">Figure&nbsp;1</a> shows that there are two ways of reusing the data, by rearrange them or by reweighed. Rearranging the data leads to <strong>bootstrapping</strong> or <strong>cross validation</strong> while reweighed is used for <strong>Bayesian Bootstrap</strong> or <strong>boosting</strong>.</p>
<p>In <em>bootstrapping</em> the data are re-sampled randomly with replacement <span class="math inline">\(B\)</span> times and the model is refitted <span class="math inline">\(B\)</span> times. This provides information about the variability of the fitted model. For distributional regression models (fitted the <em>classical</em> way, bootstrapping provides extra information about the variability of all the parameters involved, i.e.&nbsp;distributional parameters, coefficients, hyper parameters and random effects.</p>
<!-- Bootstrapping helps to evaluate how far the sample is from the population by giving an estimate of the variability between the different sub-samples. It also helps to calculate standard errors from a fitted model when there is no an easy way to do so with the conventional methods. It helps us to evaluate the variability of all of the parameters of a fitted GAMLSS by providing standard errors not only for the coefficient of the model but also for the random effects and hyper parameters, see @sec-ParametersforEstimation for the definition of different parameters.  -->
<p>A <span class="math inline">\(k\)</span>-fold <em>cross validation</em> splits the data in <span class="math inline">\(k\)</span> sub-samples. The model is fitted to the <span class="math inline">\(k-1\)</span> sets (which is used as the training set) and the remaining fold for evaluating the model. Leave one out, <strong>LOO</strong>, is an extreme version of K-fold partition in which we pick <span class="math inline">\(n-1\)</span> observations for training and leave one out for test. Note that both bootstrapping and <span class="math inline">\(k\)</span>-fold cross validation can help i) model comparison ii) avoiding overfitting and iii) selecting hyper parameters.</p>
<p>Note that for both bootstrapping and <span class="math inline">\(k\)</span>-fold cross validation we do not have actually to split the data we only need a vector indexing which observations we have to pick up from the original sample. In <em>Bayesian bootstrapping</em>, the weights are samples from a multinomial distribution. In <em>boosting</em> each week learner, that is each fit, is reweighed using as weights the residuals of the previous fit.</p>
<p>Note that the split between <strong>rearranged</strong> and <strong>reweighed</strong> in <a href="#fig-data_split" class="quarto-xref">Figure&nbsp;1</a> is a rather artificial since both methods can be thought as refitting the model to the data using different prior weights. For bootstrapping the prior weights will be <span class="math inline">\(0\)</span> for observations that were not selected. <span class="math inline">\(1\)</span> for observations that were selected once in the re-sampling, <span class="math inline">\(2\)</span> for observations selected twice, e.t.c. The vector of prior weights in bootstrapping should sum up to <span class="math inline">\(n\)</span>, the number of observations. Similarly the weights, when we apply a <span class="math inline">\(k\)</span>-th fold cross validation, will be <span class="math inline">\(1\)</span> for the <span class="math inline">\(k-1\)</span> samples and <span class="math inline">\(0\)</span> for the remaining observations. In both cases, we refer to observations with non-zero weights as <strong>in-bag</strong> and observations with zero weights as <strong>out-of-bag</strong>. In Bayesian bootstrapping, the weights, samples from a multinomial distribution, should be sum up to <span class="math inline">\(n\)</span>.</p>
</section>
<section id="sec-data_part" class="level2">
<h2 class="anchored" data-anchor-id="sec-data_part"><code>data_part()</code></h2>
<p>The function <code>data_part()</code> it does not partitioning the data as such but adds a factor caled <code>partition</code> to the data indicating the partition. By default tha data are partitioned into two sets the training ,<code>train</code>and the test, ‘test’.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>dap <span class="ot">&lt;-</span> gamlss.prepdata<span class="sc">:::</span><span class="fu">data_part</span>(da)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>data partition into two sets </code></pre>
</div>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dap)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      rent area yearc location bath kitchen cheating partition
1 109.9487   26  1918        2    0       0        0     train
2 243.2820   28  1918        2    0       0        1      test
3 261.6410   30  1918        1    0       0        1     train
4 106.4103   30  1918        2    0       0        0      test
5 133.3846   30  1918        2    0       0        1      test
6 339.0256   30  1918        2    0       0        1     train</code></pre>
</div>
</div>
<p>If the user like to have the data in separate <code>data.frame</code> use;</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>daTrain <span class="ot">&lt;-</span> <span class="fu">subset</span>(dap, partition<span class="sc">==</span><span class="st">"train"</span>)</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>daTest <span class="ot">&lt;-</span> <span class="fu">subset</span>(dap, partition<span class="sc">==</span><span class="st">"test"</span>)</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(daTrain)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1846    8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(daTest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1236    8</code></pre>
</div>
</div>
<p>Note that if;</p>
<ol type="i">
<li><p><code>partition=2L</code> the factor has two levels <code>train</code>, and <code>test</code>.</p></li>
<li><p><code>partition=3L</code> the factor has three levels <code>train</code>, <code>val</code> (for validation) and <code>test</code>.</p></li>
<li><p><code>partition &gt; 4L</code> say <code>K</code> then the levels are <code>1</code>, <code>2</code>…<code>K</code>. The factor then can be used for K-fold cross validation.</p></li>
</ol>
</section>
<section id="sec-data_part_list" class="level2">
<h2 class="anchored" data-anchor-id="sec-data_part_list"><code>data_part_list()</code></h2>
<p>The function <code>data_part_list()</code> instead of adding a factor to the data as the <code>data_part()</code> function does it creates a list with elements the training, test and validation data sets. The function only split the data to up to three subsets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>allda <span class="ot">&lt;-</span>  <span class="fu">data_part_list</span>(rent) </span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(allda[[<span class="dv">1</span>]]) <span class="co"># training data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1200    9</code></pre>
</div>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(allda[[<span class="dv">2</span>]]) <span class="co"># test data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 769   9</code></pre>
</div>
</div>
</section>
<section id="sec-data_data_part_index" class="level2">
<h2 class="anchored" data-anchor-id="sec-data_data_part_index"><code>data_part_index()</code></h2>
<p>The function <code>data_part_index()</code> takes a data.frame and produces a list of indexes which then can be used to select different sections of the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>index <span class="ot">&lt;-</span>  <span class="fu">data_part_index</span>(rent) </span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>trdata <span class="ot">&lt;-</span> rent[index[[<span class="dv">1</span>]],]</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>tedata<span class="ot">&lt;-</span> rent[index[[<span class="dv">2</span>]],]</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(trdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 984   9</code></pre>
</div>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(tedata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 985   9</code></pre>
</div>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(trdata)[<span class="dv">1</span>]<span class="sc">+</span><span class="fu">dim</span>(tedata)[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1969</code></pre>
</div>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(rent)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1969    9</code></pre>
</div>
</div>
</section>
<section id="sec-data_cut" class="level2">
<h2 class="anchored" data-anchor-id="sec-data_cut"><code>data_cut()</code></h2>
<p>The function <code>data_cut()</code> randomly selects part of the data. The main reason that the function is created is because plotting routines in the package <strong>ggplot2</strong> take very long time especially with very large data sets. This function either automatically cut the data according the the number of observation in the data or cut the data to a specified % by the user. In the later case let assume that only <span class="math inline">\(50%\)</span> of the data are needed;</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>da1 <span class="ot">&lt;-</span> <span class="fu">data_cut</span>(rent99, <span class="at">percentage=</span>.<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 50 % of data are saved, 
that is, 1541 observations. </code></pre>
</div>
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(rent99)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3082    9</code></pre>
</div>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(da1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1541    9</code></pre>
</div>
</div>
<p>In the formal case the following conversion is used; let <span class="math inline">\(N\)</span> the number of observations, if;</p>
<ul>
<li><p><span class="math inline">\(N \le 50.000\)</span>: all data are used;</p></li>
<li><p><span class="math inline">\(50.000 &lt; N \le 100.000\)</span>: 50% of the data are used;</p></li>
<li><p><span class="math inline">\(100.000 &lt; N \le 1.000.000\)</span> 20% of the data are used;</p></li>
<li><p><span class="math inline">\(N&gt;1.000.000\)</span> 10$; 10% of the data are used;</p></li>
</ul>
</section>
</section>
<section id="functions-to-be-checked-and-documented-in-the-manual" class="level1">
<h1>Functions to be checked and documented in the manual</h1>
<section id="xy_power_trans" class="level2">
<h2 class="anchored" data-anchor-id="xy_power_trans"><code>xy_power_trans()</code></h2>
</section>
<section id="y_power_trans" class="level2">
<h2 class="anchored" data-anchor-id="y_power_trans"><code>y_power_trans()</code></h2>
</section>
<section id="datetime2datehour" class="level2">
<h2 class="anchored" data-anchor-id="datetime2datehour"><code>datetime2dateHour()</code></h2>
</section>
<section id="time2num" class="level2">
<h2 class="anchored" data-anchor-id="time2num"><code>time2num()</code></h2>
</section>
<section id="data_kfold" class="level2">
<h2 class="anchored" data-anchor-id="data_kfold"><code>data_kfold()</code></h2>
</section>
<section id="data_boot" class="level2">
<h2 class="anchored" data-anchor-id="data_boot"><code>data_boot()</code></h2>
</section>
<section id="mat2df" class="level2">
<h2 class="anchored" data-anchor-id="mat2df"><code>mat2df()</code></h2>
<p>This function take a 2 dimensional array (matrix or table) and creates a <code>data.frame</code> containing the values of the table and the row and columns as factors. The function is used in plotting routings when the output is saved as a matrix while to plot it in <code>ggplots</code> plot needed to be translated into a <code>data.frame</code>. It is similat to the function <code>melt()</code> of the packages <strong>reshape2</strong>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>tabl <span class="ot">&lt;-</span> <span class="fu">table</span>(rent<span class="sc">$</span>H, rent<span class="sc">$</span>loc)</span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mat2df</span>(tabl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data_association" class="level2">
<h2 class="anchored" data-anchor-id="data_association"><code>data_association()</code></h2>
</section>
</section>
<section id="sec-Family" class="level1">
<h1>Plotting Distribution Families</h1>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>All function below are in the <strong>gamlss.ggplots</strong> package not in <strong>gamlss.prepdata</strong>. But sinse they can be useful at a pre-modelling stage are presented here.</p>
</div>
</div>
<p>Here no fitted model is required only values for the parameters have to be specified.</p>
<section id="family_pdf" class="level2">
<h2 class="anchored" data-anchor-id="family_pdf"><code>family_pdf()</code></h2>
<p>The function <code>family_pdf()</code> plots individual pdf’s from <strong>gamlss.family</strong> distribution. It needs the family argument.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">family_pdf</span>(<span class="at">from=</span><span class="sc">-</span><span class="dv">5</span>,<span class="at">to=</span><span class="dv">5</span>, <span class="at">mu=</span><span class="dv">0</span>, <span class="at">sigma=</span><span class="fu">c</span>(.<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fam_pdf_continuous" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-fam_pdf_continuous-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="gamlss_prepdata_functions_files/figure-html/fig-fam_pdf_continuous-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fam_pdf_continuous-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Continuous response example: plotting the pdf of a normal random variable.
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">family_pdf</span>(NBI, <span class="at">to=</span><span class="dv">15</span>, <span class="at">mu=</span><span class="dv">1</span>, <span class="at">sigma=</span><span class="fu">c</span>(.<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">alpha=</span>.<span class="dv">9</span>, <span class="at">size.seqment =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fam_pdf_discrete" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-fam_pdf_discrete-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="gamlss_prepdata_functions_files/figure-html/fig-fam_pdf_discrete-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fam_pdf_discrete-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Count response example: plotting the pdf of a beta binomial.
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="fu">family_pdf</span>(BB, <span class="at">to=</span><span class="dv">15</span>, <span class="at">mu=</span>.<span class="dv">5</span>, <span class="at">sigma=</span><span class="fu">c</span>(.<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">2</span>),  <span class="at">alpha=</span>.<span class="dv">9</span>, , <span class="at">size.seqment =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fam_pdf_binomial" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-fam_pdf_binomial-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="gamlss_prepdata_functions_files/figure-html/fig-fam_pdf_binomial-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fam_pdf_binomial-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Beta binomial response example: plotting the pdf of a beta binomial.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="family_cdf" class="level2">
<h2 class="anchored" data-anchor-id="family_cdf"><code>family_cdf</code></h2>
<p>The function plots individual cdf’s from <strong>gamlss.family</strong> distribution. It needs the family argument.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="fu">family_cdf</span>(NBI, <span class="at">to=</span><span class="dv">15</span>, <span class="at">mu=</span><span class="dv">1</span>, <span class="at">sigma=</span><span class="fu">c</span>(.<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">alpha=</span>.<span class="dv">9</span>, <span class="at">size.seqment =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fam_cdf_discrete" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-fam_cdf_discrete-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="gamlss_prepdata_functions_files/figure-html/fig-fam_cdf_discrete-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fam_cdf_discrete-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Count response example: plotting the cdf of a negative binomial.
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="fu">family_cdf</span>(BB, <span class="at">to=</span><span class="dv">15</span>, <span class="at">mu=</span>.<span class="dv">5</span>, <span class="at">sigma=</span><span class="fu">c</span>(.<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">2</span>),  <span class="at">alpha=</span>.<span class="dv">9</span>, , <span class="at">size.seqment =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fam_cdf_binomial" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-fam_cdf_binomial-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="gamlss_prepdata_functions_files/figure-html/fig-fam_cdf_binomial-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fam_cdf_binomial-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Count response example: plotting the cdf of a beta binomial.
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="family_cor" class="level2">
<h2 class="anchored" data-anchor-id="family_cor"><code>family_cor()</code></h2>
<p>The function <code>family_cor()</code> provides a crude way of checking the inter correlation of parameters within any <code>gamlss.family</code> distribution. It</p>
<ul>
<li><p>generates 10000 values from the specified distribution,</p></li>
<li><p>fits the distribution to the generared data and</p></li>
<li><p>plots the correlation coefficients of the parameters.</p></li>
</ul>
<p>Those correlation coefficients are taken from the fitted variance covariance matrix.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>The method only provides an idea of how the correlations between parameters are at specified points of the distribution parameters. At different parameter points the distribution could behave completely different.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="co">#source("~/Dropbox/github/gamlss-ggplots/R/family_cor.R")</span></span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>gamlss.ggplots<span class="sc">:::</span><span class="fu">family_cor</span>(<span class="st">"BCTo"</span>, <span class="at">mu=</span><span class="dv">1</span>, <span class="at">sigma=</span><span class="fl">0.11</span>, <span class="at">nu=</span><span class="dv">1</span>, <span class="at">tau=</span><span class="dv">5</span>, <span class="at">no.sim=</span><span class="dv">10000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fam_correlation" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-fam_correlation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="gamlss_prepdata_functions_files/figure-html/fig-fam_correlation-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fam_correlation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Family correlation of a BCTo distribution at specified values of the parameters.
</figcaption>
</figure>
</div>
</div>
</div>
<!-- \subsection{Time Series and spatial feature} -->
<!-- \label{Time Series and spatial feature} -->
<!-- ``` -->
</section>
<section id="time-series" class="level2">
<h2 class="anchored" data-anchor-id="time-series">Time Series</h2>
<p>Time series data sets are data in which observations are observed during the same time interval i.e.&nbsp;daily. Time series data are treated differently because observations closer to each other over time tend to have similar values and therefore the assumption of independence between observations is not hold. In spatial data sets the same apply for observations closer in space (rather in time). Again the independence assumption is violated. Very often while data sets contain spatial ot time series features i.e.&nbsp;longitude and latitude or time stamp features i.e.&nbsp;12/10/2012 (day, month, year) those variables not used for modelling but rather interpretation of the results. This book is not design to deal with time series or spatial data but if those features exist in the data we have to ensure that are properly read in <strong>R</strong>. The function <code>as.Date()</code> is design to read dates in <strong>R</strong>. To understand how the function and similar functions are working please look at their help files. i.e.&nbsp;<code>help("as.Date")</code>. Here, we give two simple examples of how variables which involve dates can be used. The first is considering the variable<code>dt</code> containing both date and time and we would like to separate the information into two variables one contain the date and the other one containing the hour of the day:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"01/01/2011 00:00"</span>, <span class="st">"01/01/2011 01:00"</span>, <span class="st">"01/01/2011 02:00"</span>, <span class="st">"01/01/2011 03:00"</span>, <span class="st">"01/01/2011 04:00"</span>, <span class="st">"01/01/2011 05:00"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>function to do the separation</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>datetime2datehour <span class="ot">&lt;-</span> <span class="cf">function</span>(datetime, <span class="at">format=</span><span class="cn">NULL</span>) </span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>  { </span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a>          X <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">as.data.frame</span>(<span class="fu">strsplit</span>(datetime,<span class="st">' '</span>))) </span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(X) <span class="ot">&lt;-</span> <span class="cn">NULL</span> </span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(X) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"date"</span>, <span class="st">"time"</span>) </span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a>       hour <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">sub</span>(<span class="st">":"</span>,<span class="st">"."</span>,X[,<span class="dv">2</span>])) </span>
<span id="cb147-7"><a href="#cb147-7" aria-hidden="true" tabindex="-1"></a>      date <span class="ot">&lt;-</span> <span class="fu">as.Date</span>(X[,<span class="dv">1</span>],<span class="at">format=</span>format) </span>
<span id="cb147-8"><a href="#cb147-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">data.frame</span>(date, hour) </span>
<span id="cb147-9"><a href="#cb147-9" aria-hidden="true" tabindex="-1"></a>  } </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>P <span class="ot">&lt;-</span> <span class="fu">datetime2datehour</span>(dt, <span class="st">"%d/%m/%Y"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The second example contains time given in its common format, <code>c("12:35", "10:50")</code> and we would like t change it to numeric which we can use in the model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"12:35"</span>, <span class="st">"10:50"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The function to change this to numeric;</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>time2num <span class="ot">&lt;-</span> <span class="cf">function</span>(time, <span class="at">pattern=</span><span class="st">":"</span>) </span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>  { </span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>  t <span class="ot">&lt;-</span> <span class="fu">gsub</span>(pattern, <span class="st">"."</span>, time) </span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">as.numeric</span>(t) </span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a>  } </span>
<span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a><span class="fu">time2num</span>(t) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 12.35 10.50</code></pre>
</div>
</div>
<p>For user who deal with a lot of time series try the function and also the function <code>select()</code> from the <strong>dplur</strong> package.</p>

</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-RigbyStasinopoulos05" class="csl-entry" role="listitem">
Rigby, R. A., and D. M. Stasinopoulos. 2005. <span>“Generalized Additive Models for Location, Scale and Shape (with Discussion).”</span> <em>Applied Statistics</em> 54: 507–54.
</div>
</div></section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>